<?phpnamespace Sistema\Util;use Zend\Session\Container;class UsoFnc {    public static function bloqueDivQuincho($id_uso,$fecha,$clase,$titulo,$alias,$cupo,$estado,$garantia,$reserva,$flag)    {                         $a_link='href="javascript:void(0)" onclick=verQuincho("'.$id_uso.'","'.$fecha.'")';       if("Mantenimiento"==$estado){        $a_link='href=#';        $clase='grade-default';        $flag='-';        $garantia='-';       }              return '<a '.$a_link.'><div class="col-lg-4 col-md-4 col-sm-4 col-xs-5">        <div style="border: 2.5px solid #dede60; text-align: center; 	border-top: none; border-bottom:none;">        <table class="table '.$clase.'">               <thead>                  <tr>                  <th><i class="fa fa-cutlery"> - '.$alias.'</i></th>               </tr>                                                              </thead>              <tbody>              <tr>              <td>'.$titulo.'<br/>              <span>Cap. nejo              </span>'.$cupo.'<br/>              <strong>'.$estado.'</strong><br/>              G: $ '.$garantia.'<br/>              R: $ '.$reserva.'<br/>              '.$flag.'              </td>              </tr>        </tbody>        </table>               </div>        </div></a>';    }        public static function detalleRsvQuincho($fecha,$titulo,$alias,$cap,$rsv,$gar,$horario)    {               $sid = new Container('base');        $dpto = $sid->offsetGet('dpto');        $botones ='';                $cnt=0;                for($j=0;$j<count($horario);$j++)        {           $marcar="class='A1 btn btn-outline btn-success'";           $unidad=$horario[$j]['unidad']==""?"":$horario[$j]['unidad'];           $status=$horario[$j]['valor']==""?"Disponible":$horario[$j]['valor'];          $resta="-";            if($status=="Reserva"){                $marcar =" disabled class='A1 btn btn-danger' ";                $cnt=$cnt+1;                $resta="OK";            }            if($status=="PreReserva"){                $marcar =" disabled class='A1 btn btn-info' ";                $cnt=$cnt+1;                $resta='<span class="blink_me"><i class="fa fa-clock-o"></i>&nbsp;'.$horario[$j]['horas'].'Hrs</span>';            }            $botones = $botones.'<button type="button" id="'.$horario[$j]['id'].'" '.$marcar.' data="'.$horario[$j]['inicio'].'-'.$horario[$j]['fin'].'">'.$horario[$j]['inicio'].'<br/>'.$horario[$j]['fin'].'<br/>'.$status.'<br/><i class="fa fa-home"></i>&nbsp;'.$unidad.'<br/><strong>'.$resta.'</strong></button>';                          }                        if($cnt==count($horario)){            $mostrarDpto='';            $mostrarTurno='';            $verOtro='';        }else{            $mostrarDpto='<div class="form-group input-group">                  <span class="input-group-addon"><i class="fa fa-home"></i>&nbsp;Dpto</span>'.$dpto.'                  <input type="hidden" id="pagoRsv" value="'.$rsv.'"/>                </div>';                $mostrarTurno='<div class="form-group input-group">                    <div class="btn-group" role="group" aria-label="..." id="GroupTipo">                        <label for="tipo" class="control-label input-group">Tipo</label>                        <div class="btn-group" role="group">									<button type="button" id="PreReserva" class="B1 btn btn-outline btn-success">Pre-Reserva</button>                                    <button type="button" id="Reserva" class="B1 btn btn-outline btn-success">Reserva</button>                                    &nbsp;<i><label id="selT"></label></i>						  </div>                    </div>                                    </div>';                $verOtro='<div class="form-group">                <label>Observacion</label>                <textarea id="obs" name="obs" rows="2" placeholder="Ingrese observacion" class="form-control"></textarea>                </div>                <div class="form-group text-left">                    <div class="fileUpload btn btn-info">                        <span>Subir Foto</span>                        <input type="file" class="upload" id="seleccionaFoto"/>                    </div>                    <span id="archivoFoto">No se ha seleccionado foto</span>                </div>';        }                        return '<div class="form-group">                <i class="fa fa-calendar"></i>&nbsp;<label id="fechaIn">'.$fecha.'</label>&nbsp;&nbsp;<label>'.$titulo.' - '.$alias.' / cap:'.$cap.' / R: $ '.$rsv.' / G: $ '.$gar.'</label>                </div>               '.$mostrarDpto.'                '.$mostrarTurno.'                   <div class="form-group input-group">                   <div class="btn-group" role="group" aria-label="..." id="GroupHorario">                        <label for="turno" class="control-label input-group">Turno(s)</label>                            <div class="btn-group" role="group">'.$botones.'&nbsp;<i><label id="selH"></label></i>			                </div>                        </div>                                            </div>                                '.$verOtro.'                                <script>                                    $("#seleccionaFoto").change(function(){                        $("#archivoFoto").text($(this).val().replace("C:\\\fakepath\\\", ""));                                            });                                        $(".A1").click(function(){		              			         var id1 = $(this).attr("id");                     var msj = $(this).attr("data");                     			             $(".A1").each(function(){                          id2= $(this).attr("id"); 			             	if(id2==id1){					           $("#"+id1).addClass("active");                               $("#selH").text(msj);                               }			             	else				                $("#"+id2).removeClass("active");                            });		             });                     $(".B1").click(function(){		              			         var id1 = $(this).attr("id");                     var msj = $(this).text();                     if(msj=="Pre-Reserva"){                        msj = msj + " Tiempo de espera 12 Hrs";                     }			             $(".B1").each(function(){                          id2= $(this).attr("id"); 			             	if(id2==id1){					               $("#"+id1).addClass("active");                                   $("#selT").text(msj);                               }			             	else				                $("#"+id2).removeClass("active");                            });		             });                function blinker() {                            $(".blink_me").fadeOut(500);                            $(".blink_me").fadeIn(500);                        }                        setInterval(blinker, 1000);                </script>                                                                       ';    }            public static function historiaQuincho($miArray,$fecha)    {        $tabla='<table class="table table-hover">';        $tabla=$tabla."<thead><tr>                                <th>Quincho</th>                                <th>Dpto</th>                                <th>Turno</th>                                <th>Entrega</th>                                <th>Recibe</th>                                <th>Estado</th>                                <th>Ajuste</th>                                </tr>                        </thead>                        <tbody>";         for($i=0;$i<count($miArray);$i++)         {                                          $tabla=$tabla."<tr><td>".$miArray[$i]['nombre']."</td>                                 <td><p class='text-danger'>".$miArray[$i]['dpto']."</p></td>                                 <td><p class='text-primary'>".$miArray[$i]['turno']."</p></td>                                 <td>".$miArray[$i]['estado_entrega']."</td>                                 <td>".$miArray[$i]['estado_recibido']."</td>                                 <td>".$miArray[$i]['condicion']."</td>                                  <td><a href='javascript:void()' onclick=ajusteQ('".$miArray[$i]['idRsv']."','1','".$fecha."') ><i class='fa fa-cog fa-spin'></i></a></td>                            </tr>";          }                                                       $tabla=$tabla."</tbody></table>";                return ' <div class="row">                <div class="col-lg-12">                    <div class="panel panel-default">                        <div class="panel-heading">                            Detalle de Reserva Quincho                        </div>                        <!-- /.panel-heading -->                        <div class="panel-body">                            <div class="table-responsive">                            '.$tabla.'                            </div>                            <!-- /.table-responsive -->                        </div>                        <!-- /.panel-body -->                    </div>                    <!-- /.panel -->                </div>            </div>            <!-- /.row -->                        ';    }        public static function editarQuincho($miArray)    {       //aliasq fecha_uso     turno        estado_entrega     estado_recibido     estado      horas     condicion     monto_multa     activo         $tabla='<table class="table table-hover">';        $tabla=$tabla."<thead><tr>                                <th>Quincho</th>                                <th>Tipo</th>                                <th>Fecha</th>                                <th>Hora</th>                                <th>Tiempo</th>                                <th>Entrega</th>                                <th>Recibe</th>                                <th>Estado</th>                                <th>Multa</th>                                <th>Ajuste</th>                                </tr>                        </thead>                        <tbody>";         for($i=0;$i<count($miArray);$i++)         {              $multa="No";              if(isset($miArray[$i]['monto_multa'])){                $valor=(int)$miArray[$i]['monto_multa'];                $multa = $valor>0?"Si":"No";              }              $horas="";              if($miArray[$i]['estado']=="PreReserva" && $miArray[$i]['activo']=="1" ){                $horas=$miArray[$i]['horas'];              }              if($miArray[$i]['estado']=="PreReserva" && $miArray[$i]['activo']=="0" ){                $horas="No";              }              if($miArray[$i]['estado']=="Reserva" && $miArray[$i]['activo']=="1" ){                $horas="Si";              }                            $tabla=$tabla."<tr><td align='center'>".$miArray[$i]['aliasq']."</td>                                 <td align='center'>".$miArray[$i]['estado']."</td>                                 <td align='center'>".$miArray[$i]['fecha_uso']."</td>                                 <td align='center'>".$miArray[$i]['turno']."</td>                                 <td align='center'>".$horas."</td>                                 <td align='center'>".$miArray[$i]['estado_entrega']."</td>                                 <td align='center'>".$miArray[$i]['estado_recibido']."</td>                                 <td align='center'>".$miArray[$i]['condicion']."</td>                                 <td align='center'>".$multa."</td>                                  <td align='center'><a href='javascript:void()' onclick=ajusteQ('".$miArray[$i]['id']."','0','') >&nbsp;<i class='fa fa-cog fa-spin'></i>&nbsp;</a></td>                            </tr>";          }                                                       $tabla=$tabla."</tbody></table>";                        return '<div class="table-responsive">'.$tabla.'</div>';    }        public static function ajuste($miarray,$fechaActual,$id_db)    {        //calculo de tiempo                $nroActual = strtotime($fechaActual);        $nroFechaUso = strtotime($miarray[0]['fecha_uso']);                $tiempo="";        if($miarray[0]['estado_quincho']=="Reserva"){            $tiempo="Si";        }else{            $tiempo = $miarray[0]['tiempo_reserva'];        }                $entrega="";        if(isset($miarray[0]['estado_entrega'])){            $entrega = $miarray[0]['estado_entrega']!=""?"Entregado ".$miarray[0]['estado_entrega']:"";        }        if(isset($miarray[0]['observacion_entrega'])){            $entrega = $miarray[0]['observacion_entrega']!=""?$entrega." ".$miarray[0]['observacion_entrega']:$entrega;        }                $recibido="";        if(isset($miarray[0]['estado_recibido'])){            $recibido = $miarray[0]['estado_recibido']!=""?"Recibido ".$miarray[0]['estado_recibido']:"";        }        if(isset($miarray[0]['observacion_recibido'])){            $recibido = $miarray[0]['observacion_recibido']!=""?$recibido." ".$miarray[0]['observacion_recibido']:$recibido;        }        $multa="no posee multa";        if(isset($miarray[0]['monto_multa'])){            $multa = (int)$miarray[0]['monto_multa']>0?"Multa de $ ".$miarray[0]['monto_multa']:"no posee multa";        }        if(isset($miarray[0]['motivo_multa'])){            $multa = $miarray[0]['motivo_multa']!=""?$multa." Detalle: ".$miarray[0]['motivo_multa']:"";        }        $cancelacion="";        if(isset($miarray[0]['observacion_cancelacion'])){            $cancelacion = $miarray[0]['observacion_cancelacion']!=""?"Se anulo por: ".$miarray[0]['observacion_cancelacion']:"";        }        $verfoto='';        if(isset($miarray[0]['img_trasaccion'])){                        $verfoto=$miarray[0]['img_trasaccion']!=""?'<p class="text-primary"><i class="fa fa-eye"></i> <a href="#" id="aviewimg" data="/files/db/'.$id_db.'/conserje/quincho/'.$miarray[0]['img_trasaccion'].'" >Ver Fotografia</a></p>':"";        }        $creado="";        $cierra="";                if(isset($miarray[0]['registro'])){            $creado=$miarray[0]['registro']!=""?$miarray[0]['registro']:"";        }        if(isset($miarray[0]['date_start'])){            $creado=$miarray[0]['date_start']!=""?$creado.' con fecha '.$miarray[0]['date_start']:$creado.' sin fecha';        }                if(isset($miarray[0]['actualizo'])){            $cierra=$miarray[0]['actualizo']!=""?$miarray[0]['actualizo']:"";        }        if(isset($miarray[0]['date_update'])){            $cierra=$miarray[0]['date_update']!=""?$cierra.' con fecha '.$miarray[0]['date_update']:$cierra.' sin fecha';        }                             //acciones              $acciones ="";       $col6='col-lg-12';       if($miarray[0]['condicion']!="Cancelado" && $miarray[0]['condicion']!="Cerrado"){       $col6='col-lg-6';       $acciones='<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">                                     <div class="panel panel-success">                                        <div class="panel-heading">                                            Que deseas hacer?                                        </div>                                        <div class="panel-body">                                          <div class="form-group">                                            <strong class="text-danger">Fecha: 25-09-2015 Hora: 20:00-22:00</strong>                                            <input type="hidden" id="idAQ" value="'.$miarray[0]['id'].'" />                                            </div>                                            ';            if($miarray[0]['condicion']=="En Espera"){                        $acciones=$acciones.'<div class="form-group">                                        <button id="btnReservaOK"  class="btn btn-success">Reservar Quincho</button>                                    </div>                                    <div class="form-group">                                        <button id="btnAnularReserva"  class="btn btn-danger">Anular, Cancelar la Pre o Reserva </button>                                    </div>                                    <div class="form-group">                                        <button id="btnActDatos"  class="btn btn-primary">Actualizar Datos</button>                                    </div>';                }               if($miarray[0]['condicion']=="Abierto" && $nroActual<$nroFechaUso){                     $acciones=$acciones.'<div class="form-group">                                        <button id="btnAnularReserva"  class="btn btn-danger">Anular, Cancelar la Pre o Reserva </button>                                    </div>                                    <div class="form-group">                                        <button id="btnActDatos"  class="btn btn-primary">Actualizar Datos</button>                                    </div>';                }                                 if($miarray[0]['condicion']=="Abierto" && $nroActual>=$nroFechaUso){                     $acciones=$acciones.'                                            <div class="form-group">                                                <button id="btnFinalizaOK"  class="btn btn-success">Finalizar sin Observacion</button>                                            </div>                                            <div class="form-group">                                                <button id="btnFinalizaNOK"  class="btn btn-success">Finalizar con Observacion pero sin Multa</button>                                            </div>                                            <div class="form-group">                                                <button id="btnFinalizaConM"  class="btn btn-danger">Finalizar con Multa</button>                                            </div>                                            <div class="form-group">                                                <button id="btnAnularReserva"  class="btn btn-danger">Anular, Cancelar la Pre o Reserva </button>                                            </div>                                            <div class="form-group">                                                <button id="btnActDatos"  class="btn btn-primary">Actualizar Datos</button>                                            </div>';                }                                $acciones=$acciones.'</div>                                      </div>                                </div>';                                                                }       //fin                        return '<div class="row">                             <div class="'.$col6.' col-md-6 col-sm-6 col-xs-12">                                     <div class="panel panel-default">                                        <div class="panel-heading">                                            Datos Generales : Dpto '.$miarray[0]['nombre_unidad'].'                                        </div>                                        <div class="panel-body">                                        <p class="text-primary">Condicion: <strong>'.strtoupper($miarray[0]['condicion']).'</strong></p>                                        <p class="text-danger">'.$miarray[0]['nombre_uso'].' - '.$miarray[0]['alias_uso'].' - '.$miarray[0]['estado_uso'].'</p>                                         <p class="text-primary">Reserva: $ '.$miarray[0]['reserva_uso'].' Garantia: $ '.$miarray[0]['garantia'].'</p>                                         <p class="text-danger">Estado: '.$miarray[0]['estado_quincho'].' Tiempo: '.$tiempo.'</p>                                         <p class="text-primary">'.$entrega.'</p>                                         <p class="text-danger">'.$recibido.'</p>                                         <p class="text-primary">'.$multa.'</p>                                         <p class="text-danger">'.$cancelacion.'</p>                                         '.$verfoto.'                                         <i><code>Creado: '.$creado.'<br/>                                         Cierra: '.$cierra.'                                         </code></i>                                                                                 </div>                                      </div>                                </div>                                <!-- /.col-lg-6 (nested) -->                                                                    '.$acciones.'                                                                 <!-- /.col-lg-6 (nested) -->                                                                                              </div>                                                                                     <script>                             $("#btnFinalizaOK").click(function(){                                    $("#modalConfirma").modal("show");                                $("#confirmaAceptar").attr("data","finalizaOK");                                $("#msjConfirma").text("Estas seguro que deseas finalizar la reserva... ?");                                });                            $("#btnAnularReserva").click(function(){                                    $("#modalConfirma").modal("show");                                $("#confirmaAceptar").attr("data","anulaReserva");                                $("#msjConfirma").text("Ingrese el motivo de la anulacion de la reserva");                                $("#obsEdit").html("<textarea id=obssend class=form-control></textarea><br/>");                                });                            $("#btnFinalizaNOK").click(function(){                                    $("#modalConfirma").modal("show");                                $("#confirmaAceptar").attr("data","finalizaNOK");                                $("#msjConfirma").text("Ingrese la observacion que ha encontrado en el quincho");                                $("#obsEdit").html("<textarea id=obssend class=form-control></textarea><br/>");                                });                            $("#btnFinalizaConM").click(function(){                                    $("#modalConfirma").modal("show");                                $("#confirmaAceptar").attr("data","finalizaM");                                $("#msjConfirma").text("Ingrese el motivo de la multa y el costo");                                $("#obsEdit").html("<textarea id=obssend class=form-control></textarea><br/><p class=text-danger>(*) Valor de la multa es $ <input type=text id=multa value=25000  size=7 class=form-control/> pesos chilenos</p><br/>");                                });                                                        $("#btnActDatos").click(function(){                                alert("En Construccion... =P");                                 });                                 $("#aviewimg").click(function(){                           $("#modalViewPhoto").modal("show");                            $("#viewPhotoModal").html("<img class='.'img-responsive'.' src='.'"+$(this).attr("data")+"'.'>");                                        });                       $("#aviewimgHide").click(function(){                            $("#modalViewPhoto").modal("hide");                                                    });                            </script>                                                        ';    }     	}